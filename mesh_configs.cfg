#!/bin/bash

# SYSTEM CONFIG
numberofnodes='1' # how many nodes not counting the gateway 

# Specify devicetype:
devicetype='wdr3600'
# wdr3600 for TP-LINK WDR-3600
# wr740 for TP-LINK WR-740N
# dir810 for D-LINK DIR-810L
# dir505 for D-LINK DIR-505
# nanolocom5 for UBIQUITY NANOLOCO M5
# unifyap for  UBIQUITY UNIFY AP 
# raspi2708 for RASPBERRY BRCM 2708 (PI 1 AND 2)

# RADIOS AND FREQUENCIES
radio0_disable='0'
radio1_disable='0'
adhoc0_disable='0'
adhoc1_disable='0'
radio0_ap_disable='1'
radio1_ap_disable='1'
radio0_channel='5'    # 2.4Ghz channel
radio1_channel='157'  # 5.8Ghz channel
hide_ap_ssid='0' # if set to 1 AP`SSID's will be hidden

# MESH CONFIG
hostname='gateway'
meshssid='02_CA_FE_CA_00_12'	# for adhoc interfaces
bssid='02:CA:FE:CA:00:12'	# for adhoc interfaces
ssid='globomesh'
# wpa2key generated with https://www.wireshark.org/tools/wpa-psk.html
wpa2key='92c013cfff68a59a38a2a77da861a8cbc676e916c0446ff7b3e8d1649f3a51fe'
mobility_domain='4f57'
batman_routing_algo='BATMAN_IV'	# BATMAN_IV or BATMAN_V
interface_name='mesh'
interface_mesh_name='bat0'
interface_ifname0='adhoc0'
interface_ifname1='adhoc1'

# NETWORK CONFIG
domain='mesh.tvg'
external_dns_ip='8.8.8.8'
upstream_domain='local.lan'
upstream_dns='192.168.5.254'
ip_start='2'		    # DHCP offered range to mesh network LAN
number_of_ips='252'	# DHCP offered range to mesh network LAN
leasetime='1h'
lan_ip='10.61.34.254'
lan_netmask='255.255.255.0'
wan_protocol='dhcp'  # dhcp or static
wan_ip='192.168.2.1' # only for static config
wan_netmask='255.255.255.0' # only for static config
wan_gateway='192.168.2.254' # only for static config
batman_monitor_ip='10.61.34.1'	# batman monitoring station ip address on mesh
macfilter="disable"  # set disable to deactivate mac filter and allow to enable it, if enabled on maclist macs will be able to associate with AP
# Space separated list of MAC addresses (in the format AA:BB:CC:DD:EE:FF) allowed to be associated with all mesh APs
maclist="84:8E:0C:3E:3D:E8"
dynamicdhcp='1' # set to 1 to have dynamic ip to mesh clients, set to 0 to only serve registered clients on static_lease file

# SNMP GEOLOCATION
syslocation='Avenida Paulista 1572, [-23.5632479,-46.6573279]'
syscontact='alvinho@tvglobo.com.br'

# PLATFORM HARDWARE SPECIFICS
declare -r -A target=( [wdr3600]=ar71xx [wr740]=ar71xx [dir810]=ramips \
[nanolocom5]=ar71xx [unifyap]=ar71xx [raspi2708]=brcm2708 )

declare -r -A subtarget=( [wdr3600]=generic [wr740]=generic [dir810]=mt7620 \
[nanolocom5]=generic [unifyap]=generic [raspi2708]=bcm2708 )

declare -r -A firmware_name_imagebuilder=( [wdr3600]=lede-ar71xx-generic-tl-wdr3600-v1-squashfs-sysupgrade.bin \
[wr740]=lede-ar71xx-generic-tl-wr740n-v5-squashfs-sysupgrade.bin \
[dir810]=lede-ramips-mt7620-dir-810l-squashfs-sysupgrade.bin \
[nanolocom5]=lede-ar71xx-15.05-generic-ubnt-loco-m-xw-squashfs-sysupgrade.bin
[unifyap]=lede-ar71xx-15.05-generic-ubnt-unifi-squashfs-sysupgrade.bin \
[raspi2708]=lede-brcm2708-bcm2708-sdcard-vfat-ext4.img )

declare -r -A firmware_name_compile=( [wdr3600]=lede-ar71xx-generic-tl-wdr3600-v1-squashfs-sysupgrade.bin \
[wr740]=lede-ar71xx-generic-tl-wr740n-v5-squashfs-sysupgrade.bin \
[dir810]=lede-ramips-mt7620-dir-810l-squashfs-sysupgrade.bin \
[nanolocom5]=lede-ar71xx-generic-ubnt-loco-m-xw-squashfs-sysupgrade.bin
[unifyap]=lede-ar71xx-generic-ubnt-unifi-squashfs-sysupgrade.bin \
[raspi2708]=lede-brcm2708-bcm2708-sdcard-vfat-ext4.img )

declare -r -A packages=( [wdr3600]="alfred batctl bmon ethtool hostapd htop ip iperf iwinfo \
kmod-batman-adv kmod-usb-core kmod-usb-ohci kmod-usb2 snmpd tcpdump usbutils -wpad-mini" \
[wr740]="alfred batctl hostapd ip-tiny iwinfo kmod-batman-adv -wpad-mini" \
[dir810]="alfred batctl bmon hostapd htop ip-tiny iwinfo kmod-batman-adv snmpd -wpad-mini" )

declare -r -A profile=( [wdr3600]=tl-wdr3600-v1 [wr740]=tl-wr740n-v5 [dir810]=dir-810l )

# LEDE CONFIG
declare -r -A build_dir=( \
[BATMAN_IV]=$install_dir/lede-imagebuilder-"${target[$devicetype]}"-"${subtarget[$devicetype]}".Linux-x86_64 \
[BATMAN_V]=$install_dir/source )
